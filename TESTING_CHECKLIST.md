# ChatPDF 三层架构功能测试清单

## 🚀 服务状态
- ✅ **前端**: http://localhost:3000/
- ✅ **后端**: http://localhost:8000
- ✅ **编译状态**: 无错误

---

## 📋 功能测试清单

### **Tab 1: 服务商配置**

#### 1.1 查看服务商列表
- [ ] 左侧显示所有服务商（Local、OpenAI、Jina等）
- [ ] 点击服务商高亮选中
- [ ] 搜索框可以过滤服务商

#### 1.2 配置API
- [ ] 选择OpenAI服务商
- [ ] 输入API Key（格式：sk-...）
- [ ] 修改API Host（可选）
- [ ] 点击"点击启用"按钮 → 变为绿色"已启用"
- [ ] 点击"测试连接"按钮
  - **成功**: 显示绿色提示框 + 可用模型数
  - **失败**: 显示红色错误信息

#### 1.3 模型管理（关键新功能）
**场景1: 空状态**
- [ ] 新配置的服务商下方显示"暂无模型"提示
- [ ] 提示文字："点击上方按钮添加模型到此服务商"

**场景2: 从API获取模型**
- [ ] 点击"从 API 获取模型"按钮
- [ ] 弹出ModelListDialog对话框
- [ ] 显示loading状态（转圈图标）
- [ ] 加载完成后显示模型列表
- [ ] 每个模型有checkbox可以选择
- [ ] 勾选几个模型
- [ ] 点击"添加选中"按钮
- [ ] 对话框关闭，模型显示在服务商下方

**场景3: 手动添加模型**
- [ ] 点击"手动添加模型"按钮（蓝色）
- [ ] 弹出AddModelDialog对话框
- [ ] 填写表单：
  - 模型ID（必填）：`test-embedding-model`
  - 模型名称：`测试Embedding模型`
  - 模型类型：选择"Embedding"或"Rerank"
  - 维度（Embedding才显示）：`1536`
  - 描述：`这是一个测试模型`
- [ ] 点击"添加模型"
- [ ] 对话框关闭，新模型出现在列表中

**场景4: 查看和删除模型**
- [ ] 模型列表按类型分组（Embedding / Rerank）
- [ ] 每个模型显示：名称、维度、描述
- [ ] Rerank模型有紫色"重排"标签
- [ ] 点击模型右侧的X按钮删除模型
- [ ] 删除后模型从列表消失

---

### **Tab 2: 模型管理（全局视图）**

#### 2.1 统计卡片
- [ ] 查看4个统计卡片：
  - 总模型数
  - Embedding模型数
  - Rerank模型数
  - 活跃服务商数
- [ ] 数字与实际模型数量一致

#### 2.2 全局模型列表
**场景1: 空状态**
- [ ] 如果没有任何模型，显示"暂无模型"
- [ ] 提示"前往「服务商配置」添加模型"

**场景2: 显示所有模型**
- [ ] Embedding模型部分（绿色图标）
  - [ ] 每个模型显示服务商头像
  - [ ] 显示服务商名称、模型名称
  - [ ] 显示维度、Max Tokens、描述
- [ ] Rerank模型部分（紫色图标）
  - [ ] 每个模型显示服务商头像
  - [ ] 显示紫色"重排"标签
  - [ ] 显示服务商名称、描述

#### 2.3 全局删除功能
- [ ] 用户添加的模型右侧有删除按钮（红色X）
- [ ] 系统预设模型没有删除按钮
- [ ] 点击删除按钮后模型消失
- [ ] 统计卡片数字自动更新

---

### **Tab 3: 默认模型**

#### 3.1 Embedding默认模型
**场景1: 空状态**
- [ ] 如果没有任何Embedding模型
- [ ] 显示灰色提示框："暂无可用的 Embedding 模型"
- [ ] 提示前往服务商配置添加

**场景2: 选择默认模型**
- [ ] 下拉框列出所有Embedding模型
- [ ] 格式：`服务商名称 - 模型名称`
- [ ] 选择一个模型
- [ ] 下方显示蓝色信息卡：
  - 服务商头像
  - "当前默认模型"标题
  - 服务商名称、模型名称
  - 向量维度、说明

#### 3.2 Rerank默认模型
**场景1: 空状态**
- [ ] 如果没有Rerank模型
- [ ] 显示灰色提示框："暂无可用的 Rerank 模型"

**场景2: 选择Rerank模型（可选）**
- [ ] 下拉框第一项："不使用重排模型"
- [ ] 列出所有Rerank模型
- [ ] 选择一个模型
- [ ] 显示紫色信息卡显示当前Rerank模型

#### 3.3 配置预览
- [ ] 底部"配置预览"卡片
- [ ] 左列显示当前Embedding模型名称和服务商
- [ ] 右列显示当前Rerank模型名称和服务商
- [ ] 未设置时显示"未设置"
- [ ] 提示："配置更改会立即保存到本地存储"

---

## 🔍 数据持久化测试

### 测试1: localStorage存储
1. [ ] 在Tab 1添加几个模型
2. [ ] 在Tab 3设置默认模型
3. [ ] **刷新页面** (F5)
4. [ ] 检查Tab 1：添加的模型还在
5. [ ] 检查Tab 2：统计卡片和模型列表正确
6. [ ] 检查Tab 3：默认模型还被选中

### 测试2: 版本迁移
1. [ ] 打开浏览器Console (F12)
2. [ ] 查看Console输出：
   - `✅ Loaded user model collection (v3.0)`
   - `✅ Loaded default models (v3.0)`
3. [ ] 无错误提示

---

## 🐛 错误处理测试

### 测试1: API获取模型失败
1. [ ] 配置错误的API Key
2. [ ] 点击"从 API 获取模型"
3. [ ] 显示红色错误提示
4. [ ] 错误信息清晰易懂

### 测试2: 手动添加验证
1. [ ] 打开"手动添加模型"对话框
2. [ ] 不填写"模型ID"，直接点击"添加"
3. [ ] 显示红色错误："模型 ID 是必填项"
4. [ ] 填写后可以成功添加

### 测试3: 复合键解析
1. [ ] 添加模型ID包含特殊字符的模型（如：`model:test`）
2. [ ] 在Tab 3选择该模型作为默认
3. [ ] 刷新页面
4. [ ] 检查默认模型是否还被正确选中

---

## ✅ 关键验证点

### Context层级验证
在浏览器Console中检查：
```javascript
// 打开Console (F12)，运行以下命令：

// 1. 检查Provider层级
localStorage.getItem('providerVersion')  // 应该是 "3.0"

// 2. 检查Model层级
localStorage.getItem('userModelsVersion')  // 应该是 "3.0"
localStorage.getItem('userModels')  // 应该有JSON数据

// 3. 检查Defaults层级
localStorage.getItem('defaultModelsVersion')  // 应该是 "3.0"
localStorage.getItem('defaultModels')  // 应该有JSON数据，包含embeddingModel和rerankModel
```

### 复合键格式验证
```javascript
// 查看默认模型的存储格式
JSON.parse(localStorage.getItem('defaultModels'))
// 应该看到类似：
// {
//   "embeddingModel": "openai:text-embedding-3-large",
//   "rerankModel": "jina:jina-reranker-v2-base-multilingual"
// }
```

---

## 📊 测试结果记录

| 功能模块 | 测试项 | 状态 | 备注 |
|---------|--------|------|------|
| Tab 1 - 服务商列表 | | ⬜ 未测试 / ✅ 通过 / ❌ 失败 | |
| Tab 1 - API配置 | | | |
| Tab 1 - 从API获取模型 | | | |
| Tab 1 - 手动添加模型 | | | |
| Tab 1 - 删除模型 | | | |
| Tab 2 - 统计卡片 | | | |
| Tab 2 - 全局模型列表 | | | |
| Tab 2 - 全局删除 | | | |
| Tab 3 - Embedding选择 | | | |
| Tab 3 - Rerank选择 | | | |
| Tab 3 - 配置预览 | | | |
| 数据持久化 | | | |
| 版本迁移 | | | |

---

## 🎯 测试建议

1. **按顺序测试**: Tab 1 → Tab 2 → Tab 3
2. **先添加模型**: 确保有数据可以测试
3. **测试两种模型类型**: Embedding和Rerank都要测试
4. **测试多个服务商**: OpenAI、Jina、Local都试一下
5. **刷新页面验证**: 每个步骤完成后都刷新一次页面

## 🔧 遇到问题时

1. **打开浏览器Console** (F12)
2. **查看红色错误信息**
3. **查看localStorage数据**
4. **检查Network标签**（看API请求）
5. **截图或复制错误信息**

---

**祝测试顺利！** 🎉
